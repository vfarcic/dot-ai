kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: dot-test
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |-
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
        # Increase resource limits for parallel test execution
        max-pods: "200"
        # Increase connection limits
        kube-api-qps: "100"
        kube-api-burst: "200"
  - |-
    kind: KubeletConfiguration
    maxPods: 200
    # Optimize for test workloads
    evictionHard:
      memory.available: "100Mi"
      nodefs.available: "5%"
      nodefs.inodesFree: "3%"
    # Faster image pulls
    imageGCHighThresholdPercent: 90
    imageGCLowThresholdPercent: 80
  - |-
    kind: ClusterConfiguration
    apiServer:
      # Increase API server limits for parallel tests
      extraArgs:
        max-requests-inflight: "800"
        max-mutating-requests-inflight: "400"
        default-watch-cache-size: "200"
        watch-cache-sizes: "persistentvolumes#100,persistentvolumeclaims#100"
    etcd:
      local:
        # Optimize etcd for test workloads
        extraArgs:
          quota-backend-bytes: "4294967296" # 4GB
  extraPortMappings:
  # Expose port 3000 for REST API testing
  - containerPort: 3000
    hostPort: 3000
    protocol: TCP
  # Standard ingress ports (if needed for future tests)
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP